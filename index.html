<!DOCTYPE html>
<title>Rescue the Prince ðŸ¤´</title>
<style>
    canvas{
        outline: 1px solid #ffffff;
    }

    body{
        background-color: #000000;
        text-align: center;
        margin-top: 30 px;
    }
</style>

<canvas id="gameCanvas" data-type="game-canvas"></canvas>

<script src="js/sprite.js"></script>
<script src="js/solid.js"></script>
<script src="js/entity.js"></script>
<script src="js/pubvars.js"></script>
<script src="js/game.js"></script>

<script>
    console.log('Hello World. You must Rescue the Prince. ðŸ¤´');

    // gamestate will be used to run the game; filter specific keypresses
    gamestate = "loading";

    // lets create a floor of StoneBlocks
    for (i = 0; i < numTiles_x * tileSize; i+=48) {
        var stone = new StoneBlock(i, 450);
        solids.push(stone);
    }
    // stone1 = new StoneBlock(96, 450);
    // stone2 = new StoneBlock(96+48, 450);
    player = new Player(96+24, 150);

    // solids.push(stone1);
    // solids.push(stone2);

    entities.push(player);

    window.onload = function(){
        showTitle() // game.js
    }

    // // this will handle our keypresses
    // // TODO: move into different file
    // // TODO: add gamepad support
    // document.querySelector("html").onkeypress = function(e) {
    //     if (gamestate == "title") {
    //         startGame();
    //     } else if (gamestate == "running") {
    //     }
    // }

    // // not sure the proper way to do this movement
    // // even with this, it doesn't handle the player holding down both keys then
    // // releasing one
    // document.querySelector("html").onkeydown = function(e) {
    //     if (gamestate == "running") {
    //         // w or spacebar to jump
    //         if (e.key == "w" || e.key == " ") player.jump();
    //         if (e.key == "a") player.move("left");
    //         if (e.key == "d") player.move("right");
    //     }
    // }

    keyCodes = {"ArrowLeft":'left', "ArrowRight":'right', "ArrowUp":'up', "ArrowDown":'down',
                "a":'left', "d":'right', "w":'up', "s":'down'}
    keys = {left:0, right:0, up:0, down:0};

    document.querySelector("html").onkeydown = KeyDown;
    document.querySelector("html").onkeyup = KeyUp;

    document.querySelector("html").onkeypress = function(e) {
        if (gamestate == 'title') {
            startGame();
        }
    }

    function KeyDown(k) {
        keys[keyCodes[k.key]] = 1;
        movePlayer();
    }

    function KeyUp(k) {
        keys[keyCodes[k.key]] = 0;
        console.log(keys);
        movePlayer();
    }

    function movePlayer() {
        if (gamestate = "running") {
            player.move(keys.right - keys.left);
            if (keys.down - keys.up < 0){
                player.jump();
            }
        }
    }


    setInterval(tick, tickInterval); //tick() in game.js // tickInterval is in ms

    setupCanvas(); // game.js


</script>